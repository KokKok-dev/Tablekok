# ğŸ½ï¸ TableKok : MSA ê¸°ë°˜ ìŒì‹ì  í†µí•© ì˜ˆì•½ í”Œë«í¼

<img width="1536" height="1024" alt="image" src="https://github.com/user-attachments/assets/925e2a68-f38e-45da-b033-8aa31a764219" />


> **"ê³ ê°ê³¼ ì ì£¼ ëª¨ë‘ë¥¼ ìœ„í•œ ì˜¬ì¸ì› ì˜ˆì•½ ì†”ë£¨ì…˜"** > ì¼ë°˜ ì˜ˆì•½ë¶€í„° ì¸ê¸° ë§›ì§‘ ì‹¤ì‹œê°„ ëŒ€ê¸°ì—´(Queue), í˜„ì¥ ì›¨ì´íŒ…ê¹Œì§€ í•œ ë²ˆì— ê´€ë¦¬í•˜ëŠ” MSA ê¸°ë°˜ ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤.

<br>

## ğŸ“– í”„ë¡œì íŠ¸ ì†Œê°œ
**TableKok**ì€ ìŒì‹ì  ì˜ˆì•½, ì›¨ì´íŒ…, ë¦¬ë·° ê´€ë¦¬ë¥¼ í•˜ë‚˜ì˜ í”Œë«í¼ì—ì„œ ì œê³µí•˜ì—¬ íŒŒí¸í™”ëœ ì˜ˆì•½ ê²½í—˜ì„ í†µí•©í•©ë‹ˆë‹¤.
ë‹¨ìˆœí•œ ì˜ˆì•½ ê¸°ëŠ¥ì„ ë„˜ì–´, **ëŒ€ê·œëª¨ íŠ¸ë˜í”½ì´ ë°œìƒí•˜ëŠ” ì¸ê¸° ë§›ì§‘ì˜ ëŒ€ê¸°ì—´ ì²˜ë¦¬**ì™€ **ì‹¤ì‹œê°„ í˜„ì¥ ì›¨ì´íŒ…** ë¬¸ì œë¥¼ ê¸°ìˆ ì ìœ¼ë¡œ í•´ê²°í•˜ëŠ” ë° ì´ˆì ì„ ë§ì¶”ì—ˆìŠµë‹ˆë‹¤.

### ğŸ§‘â€ğŸ’» íŒ€ì› êµ¬ì„±

| ì´ë¦„ | ì—­í•  | ë‹´ë‹¹ ë„ë©”ì¸ ë° ê¸°ì—¬ | GitHub |
|:---:|:---:|:---|:---:|
| **íƒœì„±ì›** | íŒ€ì¥ | ğŸ” Auth, ğŸšª Gateway(Auth), ğŸ— Infra | [Link](https://github.com/trevivom76) |
| **ì´ê°€í˜„** | ë¶€íŒ€ì¥ | ğŸª Store, â³ Waiting | [Link](https://github.com/gashine20) |
| **ì†¡ì¤€ì¼** | íŒ€ì› | ğŸ” Search, â­ Review, ğŸšª Gateway(Routing) | [Link](https://github.com/thdwnsdlf61) |
| **í™©êµì„** | íŒ€ì› | ğŸ“… Reservation(Normal/Queue) | [Link](https://github.com/gyoseok17) |


### ğŸ“… í”„ë¡œì íŠ¸ ê¸°ê°„
* 2025.11.24 ~ 2025.12.26(5ì£¼)


### ğŸŒŸ í•µì‹¬ ëª©í‘œ
* **ì‚¬ìš©ì ê²½í—˜ í†µí•©:** ì˜ˆì•½, ì›¨ì´íŒ…, ë¦¬ë·°ë¥¼ í•˜ë‚˜ì˜ ì•±ì—ì„œ ì²˜ë¦¬
* **ëŒ€ìš©ëŸ‰ íŠ¸ë˜í”½ ì²˜ë¦¬:** ì¸ê¸° ë§›ì§‘ ì˜ˆì•½ ì‹œ ë°œìƒí•˜ëŠ” ë™ì‹œì„± ì´ìŠˆ ë° ì„œë²„ ë¶€í•˜ í•´ê²°
* **ì‹¤ì‹œê°„ì„± ë³´ì¥:** SSEì™€ Kafkaë¥¼ í™œìš©í•œ ì‹¤ì‹œê°„ ì•Œë¦¼ ë° ë°ì´í„° ë™ê¸°í™”
* **ê²€ìƒ‰ ì„±ëŠ¥ ìµœì í™”:** Elasticsearch + Nori ë¶„ì„ê¸°ë¥¼ ì´ìš©í•œ ë¹ ë¥´ê³  ì •í™•í•œ í•œê¸€ ê²€ìƒ‰

<br>

## ğŸ§¬ ì¸í”„ë¼ ì„¤ê³„ë„

### [ì¸í”„ë¼ ì•„í‚¤í…ì²˜]
<img width="1801" height="1131" alt="image" src="https://github.com/user-attachments/assets/b0e66817-fdc2-4d1b-ad6c-169a24ee4d5c" />

### [CI/CD]
<img width="11007" height="1172" alt="image" src="https://github.com/user-attachments/assets/c2e1e2b9-03a9-4336-ac1b-629e72201708" />

### [ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜]
<img width="2148" height="1481" alt="image" src="https://github.com/user-attachments/assets/a1748c4b-1f0e-40f9-baa7-921beb485790" />

### [ERD]
<img width="1791" height="1186" alt="image" src="https://github.com/user-attachments/assets/d1676138-aa69-4004-858b-13975852b2a3" />

<br>

## ğŸ›  ê¸°ìˆ  ìŠ¤íƒ (Tech Stack)
![Java](https://img.shields.io/badge/Java-17-007396?style=flat-square&logo=java&logoColor=white)
![Spring Boot](https://img.shields.io/badge/Spring_Boot-3.5.8-6DB33F?style=flat-square&logo=spring-boot&logoColor=white)
![Spring Data JPA](https://img.shields.io/badge/Spring_Data_JPA-ORM-6DB33F?style=flat-square&logo=spring&logoColor=white)
![Spring Cloud](https://img.shields.io/badge/Spring_Cloud-MSA-6DB33F?style=flat-square&logo=spring&logoColor=white)

![Kafka](https://img.shields.io/badge/Apache_Kafka-Event_Driven-231F20?style=flat-square&logo=apachekafka&logoColor=white)
![Redis](https://img.shields.io/badge/Redis-Caching_&_Queue-DC382D?style=flat-square&logo=redis&logoColor=white)
![Elasticsearch](https://img.shields.io/badge/Elasticsearch-Search_Engine-005571?style=flat-square&logo=elasticsearch&logoColor=white)
![SSE](https://img.shields.io/badge/SSE-Realtime-000000?style=flat-square&logo=html5&logoColor=white)

![AWS EC2](https://img.shields.io/badge/Amazon_EC2-Compute-FF9900?style=flat-square&logo=amazon-aws&logoColor=white)
![AWS RDS](https://img.shields.io/badge/Amazon_RDS-Database-527FFF?style=flat-square&logo=amazon-rds&logoColor=white)
![AWS ECS](https://img.shields.io/badge/Amazon_ECS-Container-FF9900?style=flat-square&logo=amazon-aws&logoColor=white)
![AWS ECR](https://img.shields.io/badge/Amazon_ECR-Registry-FF9900?style=flat-square&logo=amazon-aws&logoColor=white)
![Docker](https://img.shields.io/badge/Docker-Container-2496ED?style=flat-square&logo=docker&logoColor=white)
![GitHub Actions](https://img.shields.io/badge/GitHub_Actions-CI%2FCD-2088FF?style=flat-square&logo=github-actions&logoColor=white)

![JMeter](https://img.shields.io/badge/Apache_JMeter-Performance_Test-D22128?style=flat-square&logo=apachejmeter&logoColor=white)
![JitPack](https://img.shields.io/badge/JitPack-Library_Dist-81C784?style=flat-square&logo=jitpack&logoColor=white)

![Slack](https://img.shields.io/badge/Slack-Communication-4A154B?style=flat-square&logo=slack&logoColor=white)
![Discord](https://img.shields.io/badge/Discord-Communication-5865F2?style=flat-square&logo=discord&logoColor=white)
![Notion](https://img.shields.io/badge/Notion-Team_Space-000000?style=flat-square&logo=notion&logoColor=white)

| êµ¬ë¶„ | ê¸°ìˆ  (Technology) |
|:---:|:---|
| **Language & Framework** | Java 17, Spring Boot 3.2, Spring Cloud (Gateway, Eureka, OpenFeign) |
| **Database** | PostgreSQL, Redis (Caching, Pub/Sub, ZSet), Elasticsearch |
| **Message Queue** | Apache Kafka (Event-Driven Architecture) |
| **DevOps & Infra** | Docker, Zipkin (Distributed Tracing), GitHub Actions (CI/CD) |
| **Tools** | QueryDSL, SSE (Server-Sent Events), JWT |

<br>

## âœ¨ ì£¼ìš” ê¸°ëŠ¥ (Key Features)

### 1ï¸âƒ£ ì¸ì¦ ë° íšŒì› ê´€ë¦¬ (Auth Service)
* **í†µí•© íšŒì›ê°€ì…:** ì‚¬ì—…ì ë²ˆí˜¸ ìœ ë¬´ì— ë”°ë¥¸ Role ìë™ ë¶€ì—¬ (CUSTOMER / OWNER)
* **ë³´ì•ˆ:** JWT Access/Refresh Token ê¸°ë°˜ ì¸ì¦ ë° Redis Blacklistë¥¼ í†µí•œ ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬
* **Gateway:** `GlobalFilter`ë¥¼ í†µí•œ JWT íŒŒì‹± ë° `X-User-Id` í—¤ë” ì£¼ì…

### 2ï¸âƒ£ ìŒì‹ì  ê´€ë¦¬ ë° ê²€ìƒ‰ (Store & Search Service)
* **CQRS íŒ¨í„´ ì ìš©:** Command(PostgreSQL)ì™€ Query(Elasticsearch) ì±…ì„ ë¶„ë¦¬
* **ë°ì´í„° ë™ê¸°í™”:** Kafkaë¥¼ í†µí•´ Store ë³€ê²½ ì‚¬í•­ì„ Search ì„œë¹„ìŠ¤ë¡œ ì‹¤ì‹œê°„ ì „íŒŒ (Eventual Consistency)
* **ê³ ì„±ëŠ¥ ê²€ìƒ‰:** Elasticsearch Nori ë¶„ì„ê¸° í™œìš© ë° `search_after` ê¸°ë°˜ Cursor í˜ì´ì§• êµ¬í˜„

### 3ï¸âƒ£ ì˜ˆì•½ ë° ì›¨ì´íŒ… ì‹œìŠ¤í…œ (Reservation & Waiting Service)
* **ì¼ë°˜ ì˜ˆì•½:** íŠ¸ëœì­ì…˜ ë³´ì¥ì„ í†µí•œ ì¤‘ë³µ ì˜ˆì•½ ë°©ì§€ ë° ì •ì±… ê²€ì¦
* **ì¸ê¸° ë§›ì§‘ ì˜ˆì•½ (ëŒ€ê¸°ì—´):** Redis `ZSet`ì„ í™œìš©í•œ ëŒ€ê¸°ì—´ ì‹œìŠ¤í…œ (ìˆœë²ˆ ë³´ì¥, ì§„ì… ì œì–´)
* **í˜„ì¥ ì›¨ì´íŒ…:** ì‹¤ì‹œê°„ ì¤„ì„œê¸° ë° ì˜ˆìƒ ëŒ€ê¸°ì‹œê°„ ê³„ì‚°, SSEë¥¼ í†µí•œ ì…ì¥ ì•Œë¦¼

### 4ï¸âƒ£ ë¦¬ë·° ë° ì»¤ë®¤ë‹ˆí‹° (Review Service)
* **ì‹ ë¢°ì„± í™•ë³´:** ë°©ë¬¸ ì™„ë£Œ(DONE) ëœ ì˜ˆì•½ì— í•œí•´ì„œë§Œ ë¦¬ë·° ì‘ì„± ê°€ëŠ¥
* **í†µê³„ ìµœì í™”:** Kafkaë¥¼ í™œìš©í•´ ë¦¬ë·° ì‘ì„± ì‹œ í‰ê·  í‰ì /ë¦¬ë·° ìˆ˜ë¥¼ ë¹„ë™ê¸°ë¡œ ì§‘ê³„í•˜ì—¬ Store ì„œë¹„ìŠ¤ì— ë°˜ì˜

<br>

## ğŸ—£ï¸ ê¸°ìˆ ì  ì˜ì‚¬ê²°ì • (Technical Decisions)

<details>
<summary><strong>1. Monorepo vs Polyrepo: ëª¨ë…¸ë ˆí¬ ì„ íƒ</strong></summary>

* **ë°°ê²½:** 4ì¸ì˜ ì†Œê·œëª¨ íŒ€ìœ¼ë¡œ ë¹ ë¥¸ ê°œë°œê³¼ í˜‘ì—… íš¨ìœ¨ì„±ì´ í•„ìš”í•¨.
* **ì„ íƒ:** **Monorepo**
* **ì´ìœ :** ê³µí†µ ì„¤ì •(Git Convention, Build Logic) ìœ ì§€ ë¹„ìš© ê°ì†Œ ë° íŒ€ì› ê°„ ì „ì²´ ì•„í‚¤í…ì²˜ ì´í•´ë„ ì¦ì§„ì„ ìœ„í•¨.
</details>

<details>
<summary><strong>2. CQRS íŒ¨í„´ê³¼ Kafka ë„ì…</strong></summary>

* **ë¬¸ì œ:** ìŒì‹ì  ë„ë©”ì¸ì˜ ë³µì¡í•œ ì¡°ì¸ ì—°ì‚°ê³¼ ì¡°íšŒ íŠ¸ë˜í”½(Read)ì´ ì“°ê¸°(Write) íŠ¸ë˜í”½ë³´ë‹¤ ì••ë„ì ìœ¼ë¡œ ë†’ìŒ(8:2 ë¹„ìœ¨).
* **í•´ê²°:**
    * **CQRS:** Store Service(Write/RDBMS)ì™€ Search Service(Read/Elasticsearch) ë¶„ë¦¬.
    * **Kafka:** ì„œë¹„ìŠ¤ ê°„ ëŠìŠ¨í•œ ê²°í•©ì„ ìœ ì§€í•˜ë©° ë°ì´í„° ìµœì¢… ì¼ê´€ì„± ë³´ì¥. ì¥ì•  ë°œìƒ ì‹œ ë©”ì‹œì§€ ìœ ì‹¤ ë°©ì§€.
</details>

<details>
<summary><strong>3. Redis ZSetì„ í™œìš©í•œ ëŒ€ê¸°ì—´ ê´€ë¦¬</strong></summary>

* **ë¬¸ì œ:** RDBMS `COUNT(*)`ë¡œ ëŒ€ê¸° ìˆœë²ˆì„ ê³„ì‚°í•  ê²½ìš° ëŒ€ëŸ‰ íŠ¸ë˜í”½ ì‹œ DB ë¶€í•˜ ì‹¬ê°.
* **í•´ê²°:** **Redis Sorted Set (ZSet)** ë„ì….
* **ì„±ê³¼:** ëŒ€ê¸° ìˆœë²ˆ í™•ì¸ ì‹œê°„ ë³µì¡ë„ë¥¼ $O(\log N)$ìœ¼ë¡œ ë‹¨ì¶•í•˜ì—¬ ì‹¤ì‹œê°„ ì‘ë‹µ ì†ë„ ê°œì„ .
</details>

<br>

## ğŸ€ íŠ¸ëŸ¬ë¸”ìŠˆíŒ… (Troubleshooting) & ì„±ëŠ¥ ê°œì„ 
<details>
<summary><strong>1. ì¸ê¸° ë§›ì§‘ ì˜ˆì•½ íŠ¸ë˜í”½ ì œì–´ (Distributed Queue)</strong></summary>
  
* **ìƒí™©:** ì¸ê¸° ë§¤ì¥ ì˜ˆì•½ ì˜¤í”ˆ ì‹œ íŠ¸ë˜í”½ í­ì£¼ë¡œ ì¸í•œ Connection Refused ë° ì‘ë‹µ ì§€ì—° ë°œìƒ (í‰ê·  446ms, ì˜¤ë¥˜ìœ¨ 0.91%).
* **í•´ê²°:** Redis `ZSet` ê¸°ë°˜ì˜ ëŒ€ê¸°ì—´ ì‹œìŠ¤í…œ ë„ì….
* **ì§„ì… ì œì–´:** ìŠ¤ì¼€ì¤„ëŸ¬ê°€ 'Score=ì˜ˆì•½ì œí•œì‹œê°„'ì„ ê¸°ì¤€ìœ¼ë¡œ Nëª…ì”©ë§Œ ì˜ˆì•½ ê°€ëŠ¥ ìƒíƒœë¡œ ì „í™˜.
* **ìµœì í™”:** ëŒ€ê¸°ì—´ ì§„ì… ì‹œì—ë§Œ ìˆœìœ„ë¥¼ ê³„ì‚°í•˜ê³ , ì´í›„ ì•Œë¦¼ì€ 'ì…ì¥ ì¸ì› ìˆ˜'ë§Œ ì „ë‹¬í•˜ì—¬ í´ë¼ì´ì–¸íŠ¸ê°€ ìˆœìœ„ë¥¼ ê³„ì‚°í•˜ë„ë¡ í•˜ì—¬ ì„œë²„ ì—°ì‚° ìµœì†Œí™”.
* **ê²°ê³¼:** ì•ˆì •ì ì¸ íŠ¸ë˜í”½ ì²˜ë¦¬ ë° ì„œë²„ ë¦¬ì†ŒìŠ¤ íš¨ìœ¨í™” ë‹¬ì„±.
</details>

<details>
<summary><strong>2. ì›¨ì´íŒ… ë²ˆí˜¸ ë°œê¸‰ ë™ì‹œì„± ì´ìŠˆ í•´ê²°</strong></summary>
* **ë¬¸ì œ:** JMeter í…ŒìŠ¤íŠ¸ ì‹œ ë™ì‹œ ìš”ì²­ì— ëŒ€í•´ ì¤‘ë³µëœ ì›¨ì´íŒ… ë²ˆí˜¸ê°€ ë°œê¸‰ë˜ëŠ” í˜„ìƒ ë°œìƒ.
* **ì‹œë„ 1 (DB Lock):** `PESSIMISTIC_WRITE` ë½ ì ìš© â†’ ì •í•©ì„±ì€ í•´ê²°ë˜ì—ˆìœ¼ë‚˜ ëŒ€ê¸° ì‹œê°„ ëˆ„ì ìœ¼ë¡œ ì„±ëŠ¥ ì €í•˜ (72ms).
* **ì‹œë„ 2 (Redis Atomic):** **Redis `INCR` ëª…ë ¹ì–´ ì‚¬ìš©**.
* **ê²°ê³¼:** ë½ ì—†ì´ ì›ìì„±(Atomicity)ì„ ë³´ì¥í•˜ë©° ì²˜ë¦¬ ì†ë„ **72ms â†’ 0.002ms**ë¡œ íšê¸°ì  ê°œì„ .
</details>

<details>
<summary><strong>3. ë¦¬ë·° ì¡°íšŒ ì„±ëŠ¥ ìµœì í™” (Index & Cursor Paging)</strong></summary>
* **ë¬¸ì œ:** 100ë§Œ ê±´ ë°ì´í„° ì¡°íšŒ ì‹œ Full Table Scan ë°œìƒ (61.96ms), Deep Pagination ì‹œ ì„±ëŠ¥ ì €í•˜.
* **í•´ê²°:**
    1.  ë³µí•© ì¸ë±ìŠ¤ ì ìš© (`idx_store_created_at`).
    2.  `Offset` ë°©ì‹ ëŒ€ì‹  `Cursor` ê¸°ë°˜ í˜ì´ì§•(No-Offset) ë„ì….
* **ê²°ê³¼:** ì¿¼ë¦¬ ì‹¤í–‰ ì‹œê°„ **32.45ms â†’ 0.025ms (ì•½ 1,298ë°° ê°œì„ )** ë° ì¼ì •í•œ ì¡°íšŒ ì†ë„ $O(1)$ ë³´ì¥.
</details>

<br>

## ì„œë¹„ìŠ¤ë³„ í¬íŠ¸ë²ˆí˜¸
| ì„œë¹„ìŠ¤ëª… | í¬íŠ¸ë²ˆí˜¸ |
|:---:|:---:|
| **Eureka Server** | 19090 |
| **API Gateway** | 19091 |
| **User-service** | 8081 |
| **Store-service** | 8082 |
| **Search-service** | 8083 |
| **Reservation-service** | 8084 |
| **Hot-Reservation-service** | 8085 |
| **Waiting-service** | 8086 |
| **Review-service** | 8087 |

## ğŸ’¾ ì„¤ì¹˜ ë° ì‹¤í–‰ ë°©ë²• (Getting Started)

1. **Repository Clone**
   ```bash
   git clone [https://github.com/username/TableKok.git](https://github.com/username/TableKok.git)
